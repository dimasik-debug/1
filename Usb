–û—Ç–ª–∏—á–Ω–æ, —Å–µ–π—á–∞—Å –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ: —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—è—é—Ç —Ü–≤–µ—Ç, –∫–æ–º–∞–Ω–¥—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
–¢—ã —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –∫–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ —Å–≤–æ—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–æ–º–µ—Ä–∞ –ø–æ—Ä—Ç–∞, –∞ –Ω–µ –≤—Å–µ–≥–¥–∞ usbX, 01, true/false.
–ù–∞–ø—Ä–∏–º–µ—Ä:
–ö–Ω–æ–ø–∫–∞ ¬´–û–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å¬ª (–ø–æ—Ä—Ç 1) ‚Üí usb1, 01, true / usb1, 01, false
–ö–Ω–æ–ø–∫–∞ ¬´–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä¬ª (–ø–æ—Ä—Ç 2) ‚Üí usb1, 02, true / usb1, 02, false
–ö–Ω–æ–ø–∫–∞ ¬´–°–≤–µ—Ç –≤ –≥–∞—Ä–∞–∂–µ¬ª (–ø–æ—Ä—Ç 3) ‚Üí usb1, 03, true / usb1, 03, false
–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–æ 8 –ø–æ—Ä—Ç–æ–≤
–≠—Ç–æ –ª–µ–≥–∫–æ —Å–¥–µ–ª–∞—Ç—å ‚Äî –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ callback_data –∏ –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä –ø–æ—Ä—Ç–∞ –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ 01.
–ß—Ç–æ –º–µ–Ω—è–µ–º
–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏:
show_usb_menu ‚Äî —á—Ç–æ–±—ã callback_data —Å–æ–¥–µ—Ä–∂–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –ø–æ—Ä—Ç–∞
button_callback ‚Äî —á—Ç–æ–±—ã –∫–æ–º–∞–Ω–¥–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∞—Å—å —Å –Ω—É–∂–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º –ø–æ—Ä—Ç–∞ (usbX, NN, true/false)
1. –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è show_usb_menu
async def show_usb_menu(update: Update, context: ContextTypes.DEFAULT_TYPE, usb_num: int):
    names = USB1_NAMES if usb_num == 1 else USB2_NAMES
    
    state_key = f"usb{usb_num}_states"
    if state_key not in context.bot_data:
        context.bot_data[state_key] = [False] * 8

    states = context.bot_data[state_key]

    keyboard = []
    row = []
    
    for i in range(8):
        state = states[i]
        emoji = "üü¢" if state else "üî¥"
        button_text = f"{emoji} {names[i]}"
        
        # callback_data —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–º–µ—Ä –ø–æ—Ä—Ç–∞ —è–≤–Ω–æ
        callback_data = f"usb{usb_num}_toggle_{i+1:02d}"  # 01, 02, ..., 08
        
        row.append(InlineKeyboardButton(button_text, callback_data=callback_data))

        if len(row) == 2:  # 2 –∫–æ–ª–æ–Ω–∫–∏
            keyboard.append(row)
            row = []

    if row:
        keyboard.append(row)

    reply_markup = InlineKeyboardMarkup(keyboard)

    await update.message.reply_text(
        f"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ USB{usb_num} ({len(names)} —É—Å—Ç—Ä–æ–π—Å—Ç–≤)",
        reply_markup=reply_markup
    )
2. –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ button_callback
–ù–∞–π–¥–∏ –±–ª–æ–∫ if data.startswith("usb1_toggle_") or data.startswith("usb2_toggle_"):
–∏ –∑–∞–º–µ–Ω–∏ –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ —ç—Ç–æ—Ç:
# ‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ USB-–∫–Ω–æ–ø–æ–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if data.startswith("usb1_toggle_") or data.startswith("usb2_toggle_"):
        # –†–∞–∑–±–∏—Ä–∞–µ–º callback_data: usb1_toggle_01, usb2_toggle_03 –∏ —Ç.–¥.
        parts = data.split("_")
        usb_num = 1 if parts[0] == "usb1" else 2
        port_str = parts[-1]  # "01", "02", ..., "08"
        port_num = int(port_str)  # 1..8

        state_key = f"usb{usb_num}_states"
        if state_key not in context.bot_data:
            context.bot_data[state_key] = [False] * 8

        states = context.bot_data[state_key]
        old_state = states[port_num - 1]
        new_state = not old_state
        states[port_num - 1] = new_state

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º
        context.bot_data[state_key] = states

        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É —Å –Ω–æ–º–µ—Ä–æ–º –ø–æ—Ä—Ç–∞ (01, 02, ..., 08)
        port_formatted = f"{port_num:02d}"  # 01, 02, ..., 08
        command_str = f"usb{usb_num}, {port_formatted}, {str(new_state).lower()}"

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Delphi
        client_id = "delphi"  # ‚Üê –∑–∞–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π client_id —Ç–≤–æ–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
        success = send_to_delphi(client_id, {
            "command": "usb_control",
            "data": command_str
        })

        status = "—É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞" if success else "–∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω"

        # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        await query.edit_message_text(
            f"USB{usb_num} {names[port_num-1]} ‚Üí {new_state}\n"
            f"–ö–æ–º–∞–Ω–¥–∞: {command_str}\n"
            f"–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì\n"
            f"–í Delphi: {status}"
        )

        # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Ü–≤–µ—Ç–∞ –∫–Ω–æ–ø–æ–∫
        # await show_usb_menu(update, context, usb_num)
        # await query.delete_message()

        return
–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
callback_data —Ç–µ–ø–µ—Ä—å usb1_toggle_01, usb1_toggle_02 –∏ —Ç.–¥. (—Å –¥–≤—É—Ö–∑–Ω–∞—á–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º –ø–æ—Ä—Ç–∞)
–ö–æ–º–∞–Ω–¥–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏: usb1, 01, true, usb1, 02, false, usb2, 03, true –∏ —Ç.–¥.
–í –æ—Ç–≤–µ—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
USB1 –û–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å ‚Üí True
–≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ USB1 –ø–æ—Ä—Ç 1 ‚Üí True
–ü–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã
–°–æ—Ö—Ä–∞–Ω–∏ —Ñ–∞–π–ª
–ó–∞–∫–æ–º–º–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å:
git add tuya_bot.py
git commit -m "usb: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç –≤ –∫–æ–º–∞–Ω–¥–µ + –Ω–∞–∑–≤–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤"
git push
–î–æ–∂–¥–∏—Å—å –¥–µ–ø–ª–æ—è
–ù–∞–∂–º–∏ USB1 ‚Üí —É–≤–∏–¥–∏—à—å –º–µ–Ω—é —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
–ù–∞–∂–º–∏ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É ‚Üí –∫–æ–º–∞–Ω–¥–∞ –±—É–¥–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º –ø–æ—Ä—Ç–∞
–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Å–ø–∏—Å–∫–∏ USB1_NAMES –∏ USB2_NAMES –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞.
–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É.
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (¬´–í—ã —É–≤–µ—Ä–µ–Ω—ã?¬ª) –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∏–ª–∏ —á—Ç–æ-—Ç–æ –µ—â—ë ‚Äî —Å–∫–∞–∂–∏.
