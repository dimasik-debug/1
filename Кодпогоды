–û—Ç–ª–∏—á–Ω–æ, –¥–∞–≤–∞–π –¥–æ–±–∞–≤–∏–º –≤ –±–æ—Ç–∞ —É–¥–æ–±–Ω–æ–µ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ–≥–æ–¥—ã.
–í—Å–µ —á–µ—Ç—ã—Ä–µ –ª–æ–∫–∞—Ü–∏–∏ –µ—Å—Ç—å –≤ Open-Meteo (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –∏—Ö Geocoding API):
–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ ‚Äî —Ç–æ—á–Ω–æ –Ω–∞–π–¥–µ–Ω (59.93863, 30.31413)
–ö—É–¥—Ä–æ–≤–æ ‚Äî –Ω–∞–π–¥–µ–Ω (—Å–∞–º—ã–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: 59.90349, 30.51058, –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å ‚Äî —ç—Ç–æ —Ç–æ —Å–∞–º–æ–µ –ö—É–¥—Ä–æ–≤–æ –ø–æ–¥ –ü–∏—Ç–µ—Ä–æ–º)
–ù–∞–∑–∏—è ‚Äî –Ω–∞–π–¥–µ–Ω (59.89763, 31.34142, –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å)
–ü—É—Ç–∏–ª–æ–≤–æ ‚Äî –Ω–∞–π–¥–µ–Ω (59.86906, 31.44486, –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å ‚Äî –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
–ú–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤—Å–µ —á–µ—Ç—ã—Ä–µ.
–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É /weather_menu (–∏–ª–∏ –∫–Ω–æ–ø–∫—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –º–µ–Ω—é)
–ü–æ–∫–∞–∑—ã–≤–∞–µ–º inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å 4 –≥–æ—Ä–æ–¥–∞–º–∏
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É ‚Äî –≤—ã–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –≥–æ—Ç–æ–≤—É—é get_weather_7days(city))
–í–æ—Ç –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ —Ç–≤–æ–π –±–æ—Ç (–¥–æ–±–∞–≤—å –≤ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –º–µ—Å—Ç–æ).
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# –ü–æ–≥–æ–¥–∞ ‚Äî –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

CITIES_WEATHER = {
    "spb": {"name": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "query": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥"},
    "kudrovo": {"name": "–ö—É–¥—Ä–æ–≤–æ", "query": "–ö—É–¥—Ä–æ–≤–æ"},
    "naziya": {"name": "–ù–∞–∑–∏—è", "query": "–ù–∞–∑–∏—è"},
    "putilovo": {"name": "–ü—É—Ç–∏–ª–æ–≤–æ", "query": "–ü—É—Ç–∏–ª–æ–≤–æ"},
}

async def weather_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    if not has_access(update.effective_user.id):
        await update.message.reply_text("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω")
        return

    keyboard = []
    for key, city in CITIES_WEATHER.items():
        keyboard.append([
            InlineKeyboardButton(city["name"], callback_data=f"weather_city_{key}")
        ])

    reply_markup = InlineKeyboardMarkup(keyboard)

    await update.message.reply_text(
        "üå§Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –Ω–∞ 7 –¥–Ω–µ–π:",
        reply_markup=reply_markup
    )


async def weather_city_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    if not query.data.startswith("weather_city_"):
        return

    city_key = query.data.split("_")[-1]
    if city_key not in CITIES_WEATHER:
        await query.edit_message_text("–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω üòï")
        return

    city_name = CITIES_WEATHER[city_key]["name"]
    city_query = CITIES_WEATHER[city_key]["query"]

    await query.edit_message_text(f"–ó–∞–≥—Ä—É–∂–∞—é –ø—Ä–æ–≥–Ω–æ–∑ –¥–ª—è **{city_name}**... ‚è≥")

    try:
        forecast_text = await get_weather_7days(city=city_query)
        await query.edit_message_text(
            forecast_text,
            parse_mode="HTML",
            disable_web_page_preview=True
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–≥–æ–¥—ã –¥–ª—è {city_name}: {e}")
        await query.edit_message_text(f"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ –¥–ª—è {city_name}\n{e}")
–ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –±–æ—Ç–∞
–î–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ main():
app.add_handler(CommandHandler("weather_menu", weather_menu))
    app.add_handler(CallbackQueryHandler(weather_city_callback, pattern="^weather_city_"))
–î–æ–±–∞–≤—å –∫–Ω–æ–ø–∫—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é (–≤ get_reply_keyboard()):
def get_reply_keyboard():
    keyboard = [
        [KeyboardButton("üîå –í—ã–∫–ª—é—á–∞—Ç–µ–ª–∏"), KeyboardButton("üå°Ô∏è –î–∞—Ç—á–∏–∫–∏")],
        [KeyboardButton("üìã –ü—Ä–æ–µ–∫—Ç—ã"), KeyboardButton("üìú –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤")],
        [KeyboardButton("üè∑Ô∏è Wireless Tags"), KeyboardButton("üå§Ô∏è –ü–æ–≥–æ–¥–∞")],  # ‚Üê –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞
        [KeyboardButton("–†–µ–ª–µ 1"), KeyboardButton("–†–µ–ª–µ 2")],
    ]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True, one_time_keyboard=False)
–û–±—Ä–∞–±–æ—Ç–∞–π –∫–Ω–æ–ø–∫—É –≤ handle_keyboard_buttons:
elif text in ["üå§Ô∏è –ü–æ–≥–æ–¥–∞", "–ü–æ–≥–æ–¥–∞"]:
        await weather_menu(update, context)
–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É ¬´–ü–æ–≥–æ–¥–∞¬ª ‚Üí –≤—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥ ‚Üí –ø–æ–ª—É—á–∏—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑.
–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:
–∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ (–≤ context.user_data)
–¥–æ–±–∞–≤–∏—Ç—å /weather –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ (–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥)
–∏–ª–∏ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–æ–≤ –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ (–Ω–æ —Ç–µ–∫—Å—Ç —Å—Ç–∞–Ω–µ—Ç –¥–ª–∏–Ω–Ω—ã–º)
–ß—Ç–æ —Å–∫–∞–∂–µ—à—å ‚Äî –≤–Ω–µ–¥—Ä—è–µ–º —Ç–∞–∫, –∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–∏—Ç—å –∏–∫–æ–Ω–∫—É –≥–æ—Ä–æ–¥–∞, –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –≥–æ—Ä–æ–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–µ–∫—Ç–∞ Tuya)?
